SUBQUERIES:
-----------

SUBQUERY IS A SELECT STATEMENT.
SUBQUERY IS VERY USEFULL WHEN WE ARE WRITING A QUERY (ON EMP TABLE) WITH A CONDITION, THAT CONDITION ALSO BASED ON THE SAME TABLE (EMP).
WE CAN USE THE SUBQUERIES IN ANY CLAUSE LIKE SELECT,FROM AND WHERE ETC..

EXAMPLE: EXTRACT THE EMPLOYEE DETAILS WHOSE SAL LIKE BLAKE SALARY

SELECT * FROM EMP WHERE SAL=(SELECT SAL FROM EMP WHERE ENAME='BLAKE')

SUBQUERIES ARE 2 TYPES:
-----------------------
SINGLE ROW SUBQUERY : IT WILL RETURN ONLY ONE ROW 
MULTI ROW SUBQUERY : IT WILL RETURN MULTIPLE ROWS.

SINGLE ROW SUBQUERY:
--------------------

 EXTRACT THE EMPLOYEE DETAILS WHOSE SAL LIKE BLAKE SALARY

SELECT * FROM EMP WHERE SAL=(SELECT SAL FROM EMP WHERE ENAME='BLAKE')


MULTI ROW SUBQUERY:
--------------------

EXTRACT THE EMPLOYEE DETAILS WHOSE SAL LIKE BLAKE & CLARK SALARY

SELECT * FROM EMP WHERE SAL IN (SELECT SAL FROM EMP WHERE ENAME IN ('BLAKE','CLARK') )


SELECT E.EMPNO,E.ENAME,D.DNAME
FROM EMP E,DEPT D
WHERE E.DEPTNO=D.DEPTNO
OR

SELECT E.EMPNO,E.ENAME,D.DNAME
FROM 
(SELECT * FROM EMP) E,
(SELECT * FROM DEPT) D
WHERE E.DEPTNO=D.DEPTNO


ITEMS

LOCATION_ID   ITEM_ID  ITEM_NAME

101           1001     KC1000
102           1002     KC1567
103           1001     KC1000
104           1001     KC1000
105           1002     KC1567


PURCHASE_ORDERS

CUSTOMER    SOLD_DATE    ITEM_ID  QUANTITY
A           02-NOV-2015   1001      10
B           04-OCT-2015   1002      20
C           02-NOV-2015   1001      15

EXTRACT CUSTOMER NAME, SOLD_DATE AND ITEM

SELECT P.CUSTOMER,P,.SOLD_DATE,P.ITEM_ID,I.ITEM_NAME,
FROM
ITEMS I,
PURCHASE_ORDERS P
WHERE I.ITEM_ID=P.ITEM_ID

A   02-NOV-2015 1001   KC1000
A   02-NOV-2015 1001   KC1000
A   02-NOV-2015 1001   KC1000

B   04-OCT-2015 1002   KC1567
B   04-OCT-2015 1002   KC1567

C   02-NOV-2015 1001   KC1000
C   02-NOV-2015 1001   KC1000
C   02-NOV-2015 1001   KC1000

IT IS SHOWING THE DUPLICATE DATA.TO ELIMIATE DUPLICATE DATA MODIFY THE QUERY AS BELOW

SELECT P.CUSTOMER,P,.SOLD_DATE,P.ITEM_ID,I.ITEM_NAME,
FROM
(SELECT DISTINCT ITEM_ID,ITEM_NAME FROM ITEMS) I ,
PURCHASE_ORDERS P
WHERE I.ITEM_ID=P.ITEM_ID

A   02-NOV-2015 1001   KC1000
B   04-OCT-2015 1002   KC1567
C   02-NOV-2015 1001   KC1000

***WHEN EVER WE WRITE THE SUBQUERY IN FROM CLAUSE THEN IT CAN BE CALLED AS "INLINE VIEW"

EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS GREATER THEN THEIR DEPT AVG SAL


SELECT DEPTNO,AVG(SAL)
FROM EMP
GROUP BY DEPTNO

AVG_SAL

DEPTNO	AVG(SAL)
30	1566.66666666667
20	2175
10	2916.66666666667


SELECT E.*,A.AVG_SAL--IT WILL EXTRACT ALL THE COLUMNS
FROM EMP E,
(SELECT DEPTNO,AVG(SAL) AVG_SAL
FROM EMP
GROUP BY DEPTNO) A
 WHERE E.DEPTNO=A.DEPTNO
    AND E.SAL>A.AVG_SAL
  ORDER BY E.DEPTNO
  
  
SUBQUERY IN SELECT CLAUSE:
-------------------------


SELECT E.EMPNO,E.ENAME,D.DNAME
FROM EMP E,DEPT D
WHERE E.DEPTNO=D.DEPTNO

OR

SELECT E.EMPNO,E.ENAME,
(SELECT D.DNAME FROM DEPT  D WHERE E.DEPTNO=D.DEPTNO) DNAME
 FROM EMP E;
 
 
 TOP SALARIES:
 ------------
 EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS 1ST MAX SAL
 
 SELECT * FROM EMP WHERE SAL=(SELECT MAX(SAL) FROM EMP);
                               5000
 
 EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS 2ND MAX SAL
 
  SELECT * FROM EMP WHERE SAL=(SELECT MAX(SAL) FROM EMP WHERE SAL<(SELECT MAX(SAL) FROM EMP) );
  
        SELECT * FROM EMP WHERE SAL=(SELECT MAX(SAL) FROM EMP WHERE SAL<(5000) );
        
        SELECT * FROM EMP WHERE SAL=(3000);
        
EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS 3RD MAX SAL
          
SELECT * FROM EMP WHERE SAL=
(SELECT MAX(SAL) FROM EMP WHERE SAL<
       (SELECT MAX(SAL) FROM EMP WHERE SAL<
             (SELECT MAX(SAL) FROM EMP)
        ) 
);        

SELECT * FROM EMP WHERE SAL=
(SELECT MAX(SAL) FROM EMP WHERE SAL<
       (SELECT MAX(SAL) FROM EMP WHERE SAL<
             (5000)
        ) 
);   

SELECT * FROM EMP WHERE SAL=
(SELECT MAX(SAL) FROM EMP WHERE SAL<
       (3000
        ) 
);   

SELECT * FROM EMP WHERE SAL=2975
                                             
                                                                    
 
EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS 10TH MAX SAL

WE NEED TO WRITE 10 SUBQUERIES BUT IT IS VERY DIFFIUCULT TO WRITE THAT MANY QURIES
IN THIS CASE WE CAN USE CO-REALATED SUBQUERIES.


 EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS 1MIN SAL
 
 SELECT * FROM EMP WHERE SAL=(SELECT MIN(SAL) FROM EMP)
 
 EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS 2NDMIN SAL
 
 SELECT * FROM EMP WHERE SAL=(SELECT MIN(SAL) FROM EMP WHERE SAL>(SELECT MIN(SAL) FROM EMP ) )
 
  EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS 2NDMIN SAL
  
  SELECT * FROM EMP WHERE SAL=
  (SELECT MIN(SAL) FROM EMP WHERE SAL>
      (SELECT MIN(SAL) FROM EMP WHERE SAL> 
          (SELECT MIN(SAL) FROM EMP) 
      )
   )
 
 EXTRACT THE EMPLOYEE DETAILS WHOSE SAL IS 10TH MIN SAL

WE NEED TO WRITE 10 SUBQUERIES BUT IT IS VERY DIFFIUCULT TO WRITE THAT MANY QURIES
IN THIS CASE WE CAN USE CO-REALATED SUBQUERIES.
 













